window.addEventListener('message', function (ev) {
  if (ev.data === 'form-submit') {
    console.log('form-submit event has been triggered correctly')
  }
})

window.addEventListener('message', function (ev) {
  if (ev.data === 'form-close') {
    console.log('embed-auto-close-popup event has been triggered correctly')
  }
})

window.addEventListener('message', function (ev) {
  if (ev.data === 'ESC') {
    console.log('ESC embed-auto-close-popup event has been triggered correctly')
  }
})

window.addEventListener('embed-auto-close-popup', function () {
  console.log('embed-auto-close-popup event has been triggered correctly')
})

var queryString = window.location.search

var EMBED_DOM_CLASSES = [
  {
    selector: '.typeform-widget',
    attribute: 'data-url',
  }, {
    selector: '.typeform-share',
    attribute: 'href',
  }, {
    selector: '.typeform-full',
    attribute: 'src'

  },
]

window.addEventListener('DOMContentLoaded', function () {
  if (queryString.length === 0) {
    return
  }

  EMBED_DOM_CLASSES
    .forEach(function (embed) {
      var attribute = embed.attribute
      var embeds = document.querySelectorAll(embed.selector)
      embeds.forEach(function (embed) {
        var embedAttr = embed.getAttribute(attribute)
        embed.setAttribute(attribute, embedAttr + queryString)
      })
    })
})
